<?xml version="1.0" encoding="UTF-8"?>
<aiml version="2.1">
    
    <category>
        <pattern>cmdNewCharacterSpawned</pattern>
        <template>
            <think><set name="state">none</set></think>
            <think><set name="topic">none</set></think>
            {
                "Actions": "GoToMarket"
            }
        </template>
    </category>

    <category>
        <pattern>cmdReachedMarket</pattern>
        <template>
            <think><srai>generateRandomGreeting</srai></think>
			
            {
               "VoicePhrases": "<get name="phraseGreeting"></get>"
            }
		</template>
    </category>
    
    <category>
        <pattern>generateRandomGreeting</pattern>
        <template>
            <set name="phraseGreeting">
                <random>
                    <li>Hello</li>
                    <li>Good_afternoon</li>
                </random>
            </set>
        </template>
    </category>
	
    <category>
        <pattern>generateRandomRequest</pattern>
        <template>
            <srai>generateRandomFruitCount</srai>
            <srai>generatePhraseType</srai>
        </template>
    </category>
    <category>
		<pattern>addingRequest</pattern>
		<template>
			<srai>generateRandomAddRequest</srai>
			<srai>generateRandomFruitCount</srai>
			<srai>generatePhraseType</srai>
		</template>
	</category>
	<category>
		<pattern>generateRandomAddRequest</pattern>
		<template>
			<set name="addRequest">
				<random>
					<li>Could_you_also_add</li>
					<li>I_would_like</li>
					<li>I_think_I_need</li>
				</random>
			</set>
		</template>
	</category>
    <category>
        <pattern>generateRandomFruitType</pattern>
        <template>
            <set name="fruitType">
                <random>
                    <li>Apple</li>
					<li>Potato</li>
					<!--><li>Banana</li>
					<li>Peach</li>
					<li>Watermelon</li>
					<li>Carrot</li>
					<li>Tomato</li></-->
				</random>
            </set>
			<condition name="fruitType">
				<li name="questionSubject"><value><get name="questionSubject"></get></value>
					<think><srai>generateRandomFruitType</srai></think>
				</li>
				<li>
					<set name="questionSubject"><get name="fruitType"></get></set>
				</li>
			</condition>
        </template>
    </category>
    
    <category>
        <pattern>generateRandomFruitCount</pattern>
        <template>
            <set name="fruitCount">
                <random>
                    <li>One</li>
                    <li>Two</li>
                    <li>Three</li>
                    <!--><li>Four</li>
                    <li>Five</li>
                    <li>Six</li>
                    <li>Seven</li>
                    <li>Eight</li>
                    <li>Nine</li>
                    <li>Ten</li>
                    <li>Eleven</li>
                    <li>Tweleve</li>
                    <li>a_Dozen</li></-->
					<li>Some</li>
					<li>a_Couple_of</li>
                </random>
			</set>	
			<set name="fruitCountPhrase">
			 <get name="fruitCount"></get>
			</set>
            <condition name="fruitCount">
               <li value="Some">
                    <set name="fruitCount">
                        <random>
                            <li>Three</li>
							<li>Four</li>
							<li>Five</li>	
                        </random>
                    </set>
               </li>
            </condition>
            
        </template>
    </category>
    
    <category>
        <pattern>generatePhraseType</pattern>
        <template>
            <condition name="fruitCount">
                <li value="One">
                    <set name="phraseType">
                        <get name="fruitType"></get>
                    </set>
                </li>
                <li>
                    <set name="phraseType">
                        <map name="one2many"><get name="fruitType"></get></map>
                    </set>
                </li>
            </condition>
        </template>
    </category>
	
	<category>
		<pattern>generateRandomQuestion</pattern>
		<template>
			<think><srai>generateRandomFruitType</srai></think>
			<think><srai>generateQuestionPhraseType</srai></think>
			<think><srai>generateQuestion</srai></think>
			
		</template>
    </category>
	
	<category>
		<pattern>generateQuestion</pattern>
		<template>
			<set name="QuestionType">
                <random>
                    <li>Do_you_have</li>
                    <li>Have_you_got_any</li>
                </random>
            </set>
        </template>
    </category>
			
			
			
	<category>
        <pattern>generateQuestionPhraseType</pattern>
        <template>
                    <set name="questionPhraseType">
                        <map name="one2many"><get name="fruitType"></get></map>
                    </set>
        </template>
    </category>
    
    <category>
        <pattern>cmdHit</pattern>
        <template>
            {
                "Actions": "Hide"
            }
        </template>
    </category>
   
    <category>
        
		<pattern>cmdSpeechRecognized $Yes</pattern>
        <template>
			<condition name="topic">
				<li value="AvailabiltyCheck">
					<think><srai>generateRandomRequest</srai></think>
					<think><set name="topic">none</set></think>
					{
						"Actions": "SetRequest",
						"Params": ["<map name="string2int"><get name="fruitCount"></get></map>", "<get name="fruitType"></get>"],
						"VoicePhrases": "Can_i_Have <get name="fruitCountPhrase"></get> <get name="phraseType"></get>"
					}
                </li>
			</condition>
		</template>
    </category>
    
	<category>
        <pattern>cmdSpeechRecognized $No</pattern>
        <template>
			<condition name="topic">
				<li value="AvailabiltyCheck">
					<think><srai>generateRandomQuestion</srai></think>
					<think><set name="topic">AvailabiltyCheck</set></think>
					<think><set name="questionSubject"><get name="fruitType"></get></set></think>
					{
						"VoicePhrases": "what_a_pity. <get name="QuestionType"></get><get name="questionPhraseType"></get>"
					}
                </li>
			</condition>
		</template>
    </category>
	
    <category>
        <pattern>cmdSpeechRecognized $Hello</pattern>
        <template>
			<think><srai>generateRandomQuestion</srai></think>
			<think><set name="topic">AvailabiltyCheck</set></think>
			<think><set name="questionSubject">none</set></think>
			{
			 "VoicePhrases": "<get name="QuestionType"></get><get name="questionPhraseType"></get>"
			}
			
        </template>
    </category>
    
    <category>
        <pattern>cmdSpeechRecognized $12</pattern>
        <template>
            {
                "VoicePhrases": "One Two"
            }
        </template>
    </category>
    
    <category>
        <pattern>cmdBasketOverlapCharacterBegin</pattern>
        <template>
            <think><set name="topic">startChecking</set></think>
            {
                "Actions": "CheckFruitsCount"
				"VoicePhrases": "lets_see"
            }
        </template>
    </category>

    <topic name="startChecking">
        <category>
            <pattern>cmdBasketOverlapCharacterEnd</pattern>
            <template>
                <think><set name="topic">stopChecking</set></think>
            </template>
        </category>

        <category>
            <pattern>cmdCorrectFruitsCount</pattern>
            <template>
                <think><set name="topic">startTryTaking</set></think>
                {
                    "Actions": "TryToTakeBasket"
                }
            </template>
        </category>

        <category>
            <pattern>cmdIncorrectFruitsCount</pattern>
            <template>
                <think><set name="topic">startDisappointing</set></think>
                {
                    "Actions": "StartDisappointing"
                }
            </template>
        </category>
    </topic>

    <topic name="none">
        <category>
            <pattern>cmdCorrectFruitsCount</pattern>
            <template>
                <random>
                    <li>
                        <think><set name="topic">readyToTakeBasket</set></think>
                        {
                            "VoicePhrases": "Thanks"
                        }
                    </li>
					<li>
						<think><srai>addingRequest</srai></think>
						<condition name="addRequest">	
							<li value="Could_you_also_add">
								{
									"Actions": "AddRequest",
									"Params": ["<map name="string2int"><get name="fruitCount"></get></map>", "<get name="fruitType"></get>"],
									"VoicePhrases": "<get name="addRequest"></get><get name="fruitCountPhrase"></get><get name="phraseType"></get>, please?"
								}
							</li>
							<li value="I_would_like">
								{
									"Actions": "AddRequest",
									"Params": ["<map name="string2int"><get name="fruitCount"></get></map>", "<get name="fruitType"></get>"],
									"VoicePhrases": "<get name="addRequest"></get><get name="fruitCountPhrase"></get><get name="phraseType"></get> too"
								}
							</li>
							<li value="I_think_I_need">
								{
									"Actions": "AddRequest",
									"Params": ["<map name="string2int"><get name="fruitCount"></get></map>", "<get name="fruitType"></get>"],
									"VoicePhrases": "<get name="addRequest"></get><get name="fruitCountPhrase"></get> more <get name="phraseType"></get>"
								}
							</li>
						</condition>	
					</li>
                </random>
            </template>
        </category>
    </topic>
    
    <topic name="startTryTaking">
        <category>
            <pattern>cmdBasketOverlapCharacterEnd</pattern>
            <template>
                {
                    "Actions": "StopTryingToTakeBasket"
                }
            </template>
        </category>
    </topic>
    
    <category>
        <pattern>cmdCanTakeBasket</pattern>
        <template>
            {
                "Actions": "TakeBasket"
            }
        </template>
    </category>
    
    <category>
        <pattern>cmdBasketTaken</pattern>
        <template>
            <think><set name="state">startSayingGoodbye</set></think>
            <think><set name="phraseFarewell">
                <random>
                    <li>Have_great_day</li>
                    <li>Goodbye</li>
                    <li>Bye_bye</li>
                </random>
            </set></think>
            {
                "VoicePhrases": "<get name="phraseFarewell"></get>"
            }
        </template>
    </category>
    
    <category>
        <pattern>cmdAudioFinished</pattern>
        <template>
            <condition name="state" value="startSayingGoodbye">
                <think><set name="state">none</set></think>
                {
                    "Actions": "GoToHome"
                }
            </condition>
        </template>
    </category>

</aiml>